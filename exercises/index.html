<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>List of exercises &mdash; Reproducible research  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Instructor guide" href="../guide/" />
    <link rel="prev" title="Creating and sharing a container image" href="../docker/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../" class="icon icon-home"> Reproducible research
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../motivation/">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../organizing-projects/">Organizing your projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies/">Recording dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-management/">Recording computational steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments/">Recording environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sharing/">Sharing code and data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optional episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker/">Creating and sharing a container image</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">List of exercises</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#full-list">Full list</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/">Quick reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Reproducible research</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home"></a> &raquo;</li>
      <li>List of exercises</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/reproducible-research/blob/main/content/exercises.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="list-of-exercises">
<h1>List of exercises<a class="headerlink" href="#list-of-exercises" title="Permalink to this headline"></a></h1>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline"></a></h2>
<p><strong>Motivation</strong>:</p>
<ul class="simple">
<li><p>“Discuss with your neighbors or among all participants”, 5 minutes<br />
Discussion exercise. In online workshops the exercise can be performed
using a shared workshop document (e.g. HackMD) where the exercise text is copied to the document and learners are asked to write down their experiences. In in-person workshops learners can discuss in groups around their tables.</p></li>
</ul>
<p><strong>Organizing your projects</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="../organizing-projects/#an-example-project"><span class="std std-ref">Exercise : Word count - An example project</span></a>, 5 minutes<br />
This exercise is performed as a type-along. The instructor slowly and methodically goes through the steps and explains what’s happening.</p></li>
</ul>
<p><strong>Recording dependencies</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="../dependencies/#different-solutions-to-specify-requirements"><span class="std std-ref">Exercise - Different solutions to specify requirements</span></a>, 5-10 minutes<br />
This exercise can be performed as a general discussion (appropriate for online workshops) or as a group discussion (in in-person workshops). For a general discussion in online workshops the instructor can either walk through the exercise or let learners write down answers in a shared document.</p></li>
<li><p><a class="reference internal" href="../dependencies/#exploring-conda-environments"><span class="std std-ref">Exercise - Exploring conda environments</span></a>, 10 minutes:<br />
This exercise requires learners to perform steps on their own computers. In online workshops it should be done in breakout rooms for around 10 minutes.</p></li>
</ul>
<p><strong>Recording computational steps</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="../workflow-management/#snakemake-in-hpc"><span class="std std-ref">Exercise - Snakemake on High Performance Computers</span></a><br />
This is left as homework for learners who are interested.</p></li>
<li><p><a class="reference internal" href="../workflow-management/#using-snakemake"><span class="std std-ref">Exercise - Using Snakemake</span></a>, 10-15 minutes<br />
Hands-on exercise for learners to perform in groups or in breakout rooms. The purpose is for learners to understand how Snakemake operates and develop some muscle memory.</p></li>
<li><p><a class="reference internal" href="../workflow-management/#snakemake-with-conda-environments"><span class="std std-ref">Exercise - Snakemake with conda environments</span></a><br />
This is an optional exercise for learners who finish the Snakemake
exercise quickly.</p></li>
</ul>
<p><strong>Sharing code and data</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="../sharing/#connecting-repositories-to-zenodo"><span class="std std-ref">Exercise - Connecting repositories to Zenodo</span></a>, 15 minutes<br />
Hands-on exercise for learners to do in groups or breakout rooms.
The purpose is for learners to realize how easy it is to upload code or data to Zenodo and mint a DOI.</p></li>
</ul>
</section>
<section id="full-list">
<h2>Full list<a class="headerlink" href="#full-list" title="Permalink to this headline"></a></h2>
<p>This is a list of all exercises and solutions in this lesson, mainly
as a reference for helpers and instructors.  This list is
automatically generated from all of the other pages in the lesson.
Any single teaching event will probably cover only a subset of these,
depending on their interests.</p>
<section id="organizing-your-projects">
<h3>Organizing your projects<a class="headerlink" href="#organizing-your-projects" title="Permalink to this headline"></a></h3>
<p><a class="reference external" href="../organizing-projects/#exercise-0">In organizing-projects.md:</a></p>
<div class="admonition-project-organization-1-word-count exercise important admonition" id="exercise-0">
<p class="admonition-title">Project organization-1: Word count</p>
<p>Let’s look at an <a class="reference external" href="https://github.com/coderefinery/word-count">example project</a>
which follows the project structure guidelines given above.</p>
<p>This project is about counting the frequency
distribution of words in a given text, plotting results and
testing <a class="reference external" href="https://en.wikipedia.org/wiki/Zipf%27s_law">Zipf’s law</a>.
We have subdirectories for raw data, source files, documentation,
processsed data and results, and README and LICENSE files.</p>
<ul class="simple">
<li><p>What are the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">Snakefile</span></code> files for?</p></li>
<li><p>Do you think this project is reproducible?</p></li>
</ul>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> specifies dependencies of the project, i.e. all packages and their version numbers. The <code class="docutils literal notranslate"><span class="pre">Snakefile</span></code> is a record of all computational steps and is used to generate all results with <code class="docutils literal notranslate"><span class="pre">Snakemake</span></code>.</p></li>
<li><p>The Word-count project ticks most of the reproducibility boxes!</p>
<ul>
<li><p>Clear directory structure</p></li>
<li><p>README file with general project description</p></li>
<li><p>Documented, with link to ReadTheDocs</p></li>
<li><p>All dependencies recorded in <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code></p></li>
<li><p>Computational steps recorded in <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and <code class="docutils literal notranslate"><span class="pre">Snakefile</span></code></p></li>
</ul>
</li>
</ul>
</div>
</div>
</section>
<section id="recording-dependencies">
<h3>Recording dependencies<a class="headerlink" href="#recording-dependencies" title="Permalink to this headline"></a></h3>
<p><a class="reference external" href="../dependencies/#exercise-0">In dependencies.md:</a></p>
<div class="admonition-dependencies-1-comparing-requirements exercise important admonition" id="exercise-0">
<p class="admonition-title">Dependencies-1: Comparing requirements</p>
<p>Compare these four requirements.txt</p>
<p><strong>A</strong>:</p>
<p>Code depends on a number of packages but there is no <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file or equivalent.</p>
<p><strong>B</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span>
<span class="n">numpy</span>
<span class="n">sympy</span>
<span class="n">click</span>
<span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">someuser</span><span class="o">/</span><span class="n">someproject</span><span class="o">.</span><span class="n">git</span><span class="nd">@master</span>
<span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">anotheruser</span><span class="o">/</span><span class="n">anotherproject</span><span class="o">.</span><span class="n">git</span><span class="nd">@master</span>
</pre></div>
</div>
<p><strong>C</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span><span class="o">==</span><span class="mf">1.3.1</span>
<span class="n">numpy</span><span class="o">==</span><span class="mf">1.16.4</span>
<span class="n">sympy</span><span class="o">==</span><span class="mf">1.4</span>
<span class="n">click</span><span class="o">==</span><span class="mf">7.0</span>
<span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">someuser</span><span class="o">/</span><span class="n">someproject</span><span class="o">.</span><span class="n">git</span><span class="nd">@d7b2c7e</span>
<span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">anotheruser</span><span class="o">/</span><span class="n">anotherproject</span><span class="o">.</span><span class="n">git</span><span class="nd">@sometag</span>
</pre></div>
</div>
<p><strong>D</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span><span class="o">==</span><span class="mf">1.3.1</span>
<span class="n">numpy</span><span class="o">==</span><span class="mf">1.16.4</span>
<span class="n">sympy</span><span class="o">==</span><span class="mf">1.4</span>
<span class="n">click</span><span class="o">==</span><span class="mf">7.0</span>
<span class="n">someproject</span><span class="o">==</span><span class="mf">1.2.3</span>
<span class="n">anotherproject</span><span class="o">==</span><span class="mf">2.3.4</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p><strong>A</strong>: If there is no requirements.txt file (or similar), it might become very difficult
for others to create the software environment required to run your software. This can
also apply to yourself in the future!</p>
<p><strong>B</strong>: Having a requirements.txt file is definitely better than nothing. However, if the
versions are not specified you or someone else might run into problems with dependencies,
deprecated features, changes in package APIs etc.</p>
<p><strong>C</strong> and <strong>D</strong>: In both these cases exact versions of all dependencies are specified and
both others and you yourself can recreate the software environment required for the project.
<strong>D</strong> is slightly preferable because version numbers are easier to understand than Git
commit hashes or Git tags.</p>
</div>
</div>
<p><a class="reference external" href="../dependencies/#exercise-1">In dependencies.md:</a></p>
<div class="admonition-dependencies-2-working-with-conda exercise important admonition" id="exercise-1">
<p class="admonition-title">Dependencies-2: Working with conda</p>
<ul class="simple">
<li><p>Inspect your available environments with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">info</span> <span class="pre">-e</span></code>.</p></li>
<li><p>Deactivate the current environment with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">deactivate</span></code>.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">base</span></code> to change to the base environment.</p></li>
<li><p>List the packages in the base environment with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span></code>. How many packages are there?</p></li>
<li><p>Activate the coderefinery environment with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">coderefinery</span></code>.
List the packages with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span></code>.</p></li>
<li><p>Details of the conda installation can be shown with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">info</span></code>.
Which is the active environment? Where are the packages stored?
Where are the environments stored?</p></li>
<li><p>Create a new environment with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">create</span> <span class="pre">--name</span> <span class="pre">myenv</span></code> <strong>and activate it</strong>.</p></li>
<li><p>Install the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package using <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">pandas</span></code>.</p></li>
<li><p>Export the requirements into requirements.txt with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span> <span class="pre">--export</span> <span class="pre">&gt;</span> <span class="pre">requirements.txt</span></code>.</p></li>
<li><p>Export the full environment using <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">export</span> <span class="pre">&gt;</span> <span class="pre">environment.yml</span></code>, and
compare the <code class="docutils literal notranslate"><span class="pre">.yml</span></code> file format to the <code class="docutils literal notranslate"><span class="pre">.txt</span></code> file format.</p></li>
<li><p>If you want to make sure your new environment.yml is correct,
you can use it to create a new
test environment using <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-n</span> <span class="pre">&lt;envname&gt;</span> <span class="pre">-f</span> <span class="pre">&lt;file.yml&gt;</span></code>.
Were any new packages installed?
You can delete the test environment with
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">remove</span> <span class="pre">-n</span> <span class="pre">&lt;envname&gt;</span></code> or simply remove the directory of the
environment (that you can find using <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">info</span> <span class="pre">-e</span></code>).</p></li>
</ul>
</div>
</section>
<section id="recording-computational-steps">
<h3>Recording computational steps<a class="headerlink" href="#recording-computational-steps" title="Permalink to this headline"></a></h3>
<p><a class="reference external" href="../workflow-management/#solution-0">In workflow-management.md:</a></p>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ul class="simple">
<li><p>GUIs may or may not be reproducible.</p></li>
<li><p>Some GUIs can be automated, many cannot.</p></li>
<li><p>Typing the same series of commands for 100 similar inputs is tedious and error prone.</p></li>
<li><p>Imperative scripts are reproducible and great for automation.</p></li>
<li><p>Declarative workflows such as Snakemake are great for longer multi-step analyses.</p></li>
<li><p>Declarative workflows are often easy to parallelize without you changing anything.</p></li>
<li><p>With declarative workflows it is no problem to add/change things late in the project.</p></li>
<li><p>Interesting modern alternative to Make/Snakemake: <a class="reference external" href="https://taskfile.dev">https://taskfile.dev</a></p></li>
<li><p>Many <a class="reference external" href="https://github.com/common-workflow-language/common-workflow-language/wiki/Existing-Workflow-systems">specialized frameworks</a> exist.</p></li>
</ul>
</div>
<p><a class="reference external" href="../workflow-management/#exercise-0">In workflow-management.md:</a></p>
<div class="admonition-workflow-1-using-snakemake exercise important admonition" id="exercise-0">
<p class="admonition-title">Workflow-1: Using Snakemake</p>
<p>Having followed the “Exercise preparation” above, make sure that you are in the <code class="docutils literal notranslate"><span class="pre">word-count</span></code> repository.</p>
<ol class="simple">
<li><p>Start by cleaning all output with <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">--delete-all-output</span> <span class="pre">-j</span> <span class="pre">1</span></code>.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-j</span> <span class="pre">1</span></code>. How many jobs are run?</p></li>
<li><p>Try “touching” the file <code class="docutils literal notranslate"><span class="pre">data/sierra.txt</span></code> (<code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">data/sierra.txt</span></code>
(unix/git bash) or <code class="docutils literal notranslate"><span class="pre">copy</span> <span class="pre">/b</span> <span class="pre">data\sierra.txt</span> <span class="pre">+,,</span></code> (windows cmd /anaconda prompt) )
and rerun snakemake. This makes it look like the file has changed as its
timestamp is updated.<br />
Which steps of the workflow are run now, and why?</p></li>
<li><p>Now touch the file <code class="docutils literal notranslate"><span class="pre">processed_data/sierra.dat</span></code> to update the
timestamp, and run
<code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-S</span></code> (-S stands for summary). Can you make sense of the output?</p></li>
<li><p>Rerun snakemake. Which steps are run, and why?</p></li>
<li><p>Finally try touching <code class="docutils literal notranslate"><span class="pre">source/wordcount.py</span></code> and rerun snakemake.
Which steps are run, and why? Should source codes be considered
dependencies?</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">time</span></code> command to see if you get any speedup from
executing snakemake rules on multiple cores. For example to run
4 parallel threads, use <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">snakemake</span> <span class="pre">-j</span> <span class="pre">4</span></code>.</p></li>
<li><p>Try archiving the entire workflow with
<code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-j</span> <span class="pre">1</span> <span class="pre">--archive</span> <span class="pre">my-workflow.tar.gz</span></code>.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">--delete-all-output</span> <span class="pre">-j</span> <span class="pre">1</span></code>, where <code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">1</span></code> (you could also
use <code class="docutils literal notranslate"><span class="pre">--cores</span> <span class="pre">1</span></code> instead) specifies the number of CPU cores used for
execution. It should display something like <em>deleting x</em>, while
deleting previously created files (if you ran this before, otherwise
nothing).</p></li>
<li><p>Then run the process again with <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-j</span> <span class="pre">1</span></code>.
If everything went well, it should have run 11
jobs in total. Most rules have run once, but count_words and make_plot
are run 4 times each (once for each input book). In the text printed below this
in your terminal you can see when each job was run and what was done
in each job.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">data/sierra.txt</span></code> (unix/git bash) or <code class="docutils literal notranslate"><span class="pre">copy</span> <span class="pre">/b</span> <span class="pre">data\sierra.txt</span> <span class="pre">+,,</span></code> (windows cmd /anaconda prompt): this command updates the
timestamp of the file, for the program it looks like the file has been
updated/changed and will need to be reprocessed by all following steps
that are depending on this output (i.e. that use this output to do
something else with it). So, once you call <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-j</span> <span class="pre">1</span></code> again,
only the jobs concerning the sierra dataset will be rerun, not all the
processes of unchanged files. Snakemake determines which of the
following processing steps will need to be rerun once an input file is
updated. Hence e.g. make_plot is also rerun, since its input (the
output of count_words) ‘changed’.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">processed_data/sierra.dat</span></code> (unix/git bash) or <code class="docutils literal notranslate"><span class="pre">copy</span> <span class="pre">/b</span> <span class="pre">processed_data/sierra.dat</span> <span class="pre">+,,</span></code> (windows cmd /anaconda prompt), then
run <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-S</span></code> (-S stands for summary). This does not run any jobs
but gives an overview of what is the status (status column) of each
step and what will be run the next time snakemake is run (plan
column). Note that the column headers may appear not right above the
columns below, check spaces to connect columns with their column
names). Also note, that the default rule ‘all’ is not shown in
summary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-j</span> <span class="pre">1</span></code>. 4 jobs are run. You may have expected 3 as in the
summary only 3 steps had the <em>upadte pending</em> planned. However, as
mentioned above, the default rule ‘all’ was not shown in summary and
also needs to be executed in order to run the following steps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">source/wordcount.py</span></code> (unix/git bash) or <code class="docutils literal notranslate"><span class="pre">copy</span> <span class="pre">/b</span> <span class="pre">source/wordcount.py</span> <span class="pre">+,,</span></code> (windows cmd /anaconda prompt), then
<code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">-j</span> <span class="pre">1</span></code>. Until now we only ‘changed’ the output files. Here
we actually ‘change’ a script that produces these output files. Since
the wordcount.py is the very first script in the workflow on whose
results all other processes depend on, everything is run again. By
updating the scripts timestamp, snakemake assumes something has
changed in the scripts that may influence the output of the script,
and therefore also the output of every following step. Therefore it
will run all the following steps again. In this case if you would
actually change something in the wordcount.py script it would change
the output, which means if you want your research to be reproducible,
the source code as is has to be a dependency to get the same results
as you did now.</p></li>
<li><p>The speedup achieved with running on 4 instead of 1 core might be
small but it should still exist is terms of time. The example is only
small, but when running tasks where each step takes much longer to
run, this is one possible way of speeding things up.</p></li>
<li><p>For more information on archiving, see <a class="reference external" href="https://snakemake.readthedocs.io/en/stable/snakefiles/deployment.html#sustainable-and-reproducible-archiving">the official documentation</a></p></li>
</ol>
</div>
</div>
<p><a class="reference external" href="../workflow-management/#exercise-1">In workflow-management.md:</a></p>
<div class="admonition-optional-workflow-2-snakemake-and-conda exercise important admonition" id="exercise-1">
<p class="admonition-title">(Optional) Workflow-2: Snakemake and Conda</p>
<p>Let’s say that the <code class="docutils literal notranslate"><span class="pre">make_plot</span></code> rule, which runs the
<code class="docutils literal notranslate"><span class="pre">source/plotcount.py</span></code> script, requires a separate
software environment.</p>
<ol class="simple">
<li><p>Create an environment file <code class="docutils literal notranslate"><span class="pre">plotting.yml</span></code> in a new directory <code class="docutils literal notranslate"><span class="pre">envs/</span></code>.
It should contain <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> in the <code class="docutils literal notranslate"><span class="pre">channels</span></code> section and the packages
<code class="docutils literal notranslate"><span class="pre">numpy=1.17.3</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib=3.1.1</span></code> in the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> section.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">make_plot</span></code> rule in the Snakefile, add a <code class="docutils literal notranslate"><span class="pre">conda</span></code> directive
where you provide the path to the new environment file.</p></li>
<li><p>First clear all output and then rerun <code class="docutils literal notranslate"><span class="pre">snakemake</span></code> with the
<code class="docutils literal notranslate"><span class="pre">--use-conda</span> <span class="pre">--conda-frontend</span> <span class="pre">conda</span></code> flags (the latter is needed because <code class="docutils literal notranslate"><span class="pre">snakemake</span></code> prefers to use the <code class="docutils literal notranslate"><span class="pre">mamba</span></code> replacement for <code class="docutils literal notranslate"><span class="pre">conda</span></code>). Observe how snakemake downloads and installs
packages and activates the environment. The new environment is
stored in <code class="docutils literal notranslate"><span class="pre">.snakemake/conda/$hash</span></code> where $hash is the MD5 hash of
the environment file content. Updates to the environment definition
are thus automatically detected.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<ol>
<li><p>Checkout the <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-file-manually">Anaconda
documentation</a>
on how to manually create a yml file. Make sure to create the
<code class="docutils literal notranslate"><span class="pre">plotting.yml</span></code> file in the right directory. Open your preferred
editor, and add the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">plotting</span>
<span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span>
<span class="n">dependencies</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">numpy</span><span class="o">=</span><span class="mf">1.17.3</span>
  <span class="o">-</span> <span class="n">matplotlib</span><span class="o">=</span><span class="mf">3.1.1</span>
</pre></div>
</div>
</li>
<li><p>The make plot part of the snakemake file should be something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1"># create a plot for each book</span>
<span class="n">rule</span> <span class="n">make_plot</span><span class="p">:</span>
   <span class="nb">input</span><span class="p">:</span>
       <span class="n">plotcount</span><span class="o">=</span><span class="s1">&#39;source/plotcount.py&#39;</span><span class="p">,</span>
       <span class="n">book</span><span class="o">=</span><span class="s1">&#39;processed_data/</span><span class="si">{file}</span><span class="s1">.dat&#39;</span>
   <span class="n">output</span><span class="p">:</span> <span class="s1">&#39;results/</span><span class="si">{file}</span><span class="s1">.png&#39;</span>
   <span class="n">conda</span><span class="p">:</span> <span class="s2">&quot;envs/plotting.yml&quot;</span>
   <span class="n">shell</span><span class="p">:</span> <span class="s1">&#39;python </span><span class="si">{input.plotcount}</span><span class="s1"> </span><span class="si">{input.book}</span><span class="s1"> </span><span class="si">{output}</span><span class="s1">&#39;</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>First, run <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">--delete-all-output</span> <span class="pre">-j</span> <span class="pre">1</span></code> to clear all
output. Then, run <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">--use-conda</span> <span class="pre">--conda-frontend</span> <span class="pre">conda</span> <span class="pre">-j</span> <span class="pre">1</span></code>. Snakemake now finds
the envs/plotting.yml file and executes the make_plot rule inside a conda environment.</p></li>
</ol>
</div>
</div>
<p><a class="reference external" href="../workflow-management/#exercise-2">In workflow-management.md:</a></p>
<div class="admonition-optional-workflow-3-snakemake-on-hpc exercise important admonition" id="exercise-2">
<p class="admonition-title">(Optional) Workflow-3: Snakemake on HPC</p>
<ul class="simple">
<li><p>On a cluster node, Snakemake uses as many cores as available on that node. If a program that is run in a rule can only run efficiently up to a given number of CPU threads, it’s possible to manually set a maximum in the rule definition:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="n">count_words</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">wc</span><span class="o">=</span><span class="s1">&#39;source/wordcount.py&#39;</span><span class="p">,</span>
        <span class="n">book</span><span class="o">=</span><span class="s1">&#39;data/</span><span class="si">{file}</span><span class="s1">.txt&#39;</span>
    <span class="n">output</span><span class="p">:</span> <span class="s1">&#39;processed_data/</span><span class="si">{file}</span><span class="s1">.dat&#39;</span>
    <span class="n">threads</span><span class="p">:</span> <span class="mi">4</span>
    <span class="n">log</span><span class="p">:</span> <span class="s1">&#39;processed_data/</span><span class="si">{file}</span><span class="s1">.log&#39;</span>
    <span class="n">shell</span><span class="p">:</span> <span class="s1">&#39;python </span><span class="si">{input.wc}</span><span class="s1"> </span><span class="si">{input.book}</span><span class="s1"> </span><span class="si">{output}</span><span class="s1"> &gt;&gt; </span><span class="si">{log}</span><span class="s1"> 2&gt;&amp;1&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Transferring your workflow to a cluster:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ snakemake --archive myworkflow.tar.gz -j 1
$ scp myworkflow.tar.gz &lt;some-cluster&gt;
$ ssh &lt;some-cluster&gt;
$ tar zxf myworkflow.tar.gz
$ cd myworkflow
$ snakemake -n --use-conda -j 1
</pre></div>
</div>
<ul class="simple">
<li><p>Interoperability with Slurm:</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;__default__&quot;</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;account&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a_slurm_submission_account&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;mem&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1G&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0:5:0&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;count_words&quot;</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0:10:0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;mem&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2G&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The workflow can now be executed by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ snakemake -j <span class="m">100</span> --cluster-config cluster.json --cluster <span class="s2">&quot;sbatch -A {cluster.account} --mem={cluster.mem} -t {cluster.time} -c {threads}&quot;</span>
</pre></div>
</div>
<p>Note that in this case <code class="docutils literal notranslate"><span class="pre">-j</span></code> does not correspond to the number of cores
used, instead it represents the maximum number of jobs that Snakemake
is allowed to have submitted at the same time.  The <code class="docutils literal notranslate"><span class="pre">--cluster-config</span></code>
flag specifies the config file for the particular cluster, and the
<code class="docutils literal notranslate"><span class="pre">--cluster</span></code> flag specifies the command used to submit jobs on the
particular cluster.</p>
</div>
</section>
<section id="recording-environments">
<h3>Recording environments<a class="headerlink" href="#recording-environments" title="Permalink to this headline"></a></h3>
<p><a class="reference external" href="../environments/#exercise-0">In environments.md:</a></p>
<div class="admonition-optional-environment-1-play-with-docker exercise important admonition" id="exercise-0">
<p class="admonition-title">(Optional) Environment-1: Play with Docker</p>
<ol>
<li><p>This exercise requires a DockerHub account. You can sign up on <a class="reference external" href="https://hub.docker.com/signup">https://hub.docker.com/signup</a>.</p></li>
<li><p>Go to <a class="reference external" href="https://labs.play-with-docker.com/">Play with Docker</a> and log in using
your DockerHub account.</p></li>
<li><p>Click on “Add new instance” - you now have a free Alpine Linux Virtual Machine in browser where you can build and run Docker containers</p></li>
<li><p>Pull the hello-world image from DockerHub:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker pull hello-world
</pre></div>
</div>
</li>
<li><p>List local images:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker image ls
</pre></div>
</div>
</li>
<li><p>Now create a new container from the image and run it:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker run hello-world
</pre></div>
</div>
<p>This should output “Hello from Docker!” followed by a description of what just happened:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">1</span>. The Docker client contacted the Docker daemon.
<span class="m">2</span>. The Docker daemon pulled the <span class="s2">&quot;hello-world&quot;</span> image from the Docker Hub.
   <span class="o">(</span>amd64<span class="o">)</span>
<span class="m">3</span>. The Docker daemon created a new container from that image which runs the
   executable that produces the output you are currently reading.
<span class="m">4</span>. The Docker daemon streamed that output to the Docker client, which sent it
   to your terminal.
</pre></div>
</div>
</li>
<li><p>The hello-world image can’t do much more than this. For a more interesting
challenge, we can run bash in interactive mode using the ubuntu image from DockerHub. The following command automatically pulls the image before creating the container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker run -it ubuntu bash
</pre></div>
</div>
<p>Notice that the command prompt changed - we are now “inside” a live container. We can double-check that we’re indeed in an Ubuntu environment:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat /etc/os-release
</pre></div>
</div>
</li>
<li><p>Exit the container by typing <code class="docutils literal notranslate"><span class="pre">exit</span></code>.</p></li>
<li><p>Challenge: run an ubuntu container and make it print “Hello from Ubuntu!”.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">ubuntu</span></code> to run a container from the ubuntu image, and give
it the command <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;Hello</span> <span class="pre">from</span> <span class="pre">Ubuntu!&quot;</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker run ubuntu <span class="nb">echo</span> <span class="s2">&quot;Hello from Ubuntu!&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sharing-code-and-data">
<h3>Sharing code and data<a class="headerlink" href="#sharing-code-and-data" title="Permalink to this headline"></a></h3>
<p><a class="reference external" href="../sharing/#exercise-0">In sharing.md:</a></p>
<div class="admonition-sharing-1-get-a-doi-from-zenodo exercise important admonition" id="exercise-0">
<p class="admonition-title">Sharing-1: Get a DOI from Zenodo</p>
<p>Digital object identifiers (DOI) are the backbone of the academic
reference and metrics system. In this exercise we will see how to
make a GitHub repository citable by archiving it on the
<a class="reference external" href="http://about.zenodo.org/">Zenodo</a> archiving service. Zenodo is a
general-purpose open access repository created by OpenAIRE and CERN.</p>
<ol class="simple">
<li><p>Sign in to Zenodo using your GitHub account. For this exercise, use the
sandbox service: <a class="reference external" href="https://sandbox.zenodo.org/login/">https://sandbox.zenodo.org/login/</a>. This is a test version of the real Zenodo platform.</p></li>
<li><p>Go to <a class="reference external" href="https://sandbox.zenodo.org/account/settings/github/">https://sandbox.zenodo.org/account/settings/github/</a>.</p></li>
<li><p>Find the repository you wish to publish (e.g. the
<a class="reference external" href="https://github.com/coderefinery/word-count"><code class="docutils literal notranslate"><span class="pre">word-count</span></code> project that you imported</a>
or another test repo), and flip the switch to ON.</p></li>
<li><p>Go to GitHub and create a <strong>release</strong>  by clicking the <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">release</span></code> on the
right-hand side (a release is based on a Git tag, but is a higher-level GitHub feature).
You will need to enter a tag name (e.g. v0.1) in the “Choose a tag” box.</p></li>
<li><p>Creating a new release will trigger Zenodo into archiving your repository,
and a DOI badge will be displayed next to your repository after a minute
or two. You can include it in your GitHub README file: click the
DOI badge and copy the relevant format (Markdown, RST, HTML).</p></li>
</ol>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../docker/" class="btn btn-neutral float-left" title="Creating and sharing a container image" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../guide/" class="btn btn-neutral float-right" title="Instructor guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright CodeRefinery team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>